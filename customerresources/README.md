# customersource



# Таблицы
### Таблица гостей (Guest)
Данная таблица хранит данные о гостях отеля.

| Название столбца | Тип данных  | Описание                                                 |
|:----------------:|:-----------:|:---------------------------------------------------------|
|     guest_id     |     INT     | Индивидуальный номер гостя                               |
|       name       |   VARCHAR   | Фамилия Имя Отчество (ФИО)                               |
|      phone       |   VARCHAR   | Номер телефона                                           |
|      email       |   VARCHAR   | Электронная почта                                        |
|    birth_day     |    DATE     | День рождения                                            |
|     card_id      |     INT     | Номер карты лояльности                                   |
|   ch_employee    |     INT     | Индивидуальный номер сотрудника, который изменяет запись |
|      dt_ch       | TIMESTAMPTZ | Дата изменения записи                                    |

### Таблица программы лояльности гостей (GuestLoyalty)
Данная таблица хранит данные о программе лояльности гостей.  

| Название столбца | Тип данных  | Описание                                                  |
|:----------------:|:-----------:|:----------------------------------------------------------|
|     card_id      |     INT     | Номер карты лояльности                                    |
| cashback_points  |     INT     | Баллы (Кешбэк) на карте                                   |
| dt_registration  | TIMESTAMPTZ | Дата регистрации карты                                    |
|      dt_use      | TIMESTAMPTZ | Дата последнего использования                             |
|    is_actual     |   BOOLEAN   | Актуальность карты (TRUE - актуальна, FALSE - заморожена) |
|   ch_employee    |     INT     | Индивидуальный номер сотрудника, который изменяет запись  |
|      dt_ch       | TIMESTAMPTZ | Дата изменения записи                                     |

# Функции
### Добавления гостя и карты лояльности (GuestUpd)
```sql
SELECT customerresources.guestupd(_src := '
                                  {
                                    "name": "Овсянникова Софья Андреевна",
                                    "phone": "89991232211",
                                    "email": "yakov37@ya.ru",
                                    "birth_day": "1998-10-8"
                                  }
                                  ', _ch_employee := 2);
```
Пример ответа при правильном выполнении:
```jsonb
{"data" : null}
```
Примеры ошибок:
```jsonb 
{
	"errors": [
	    {
		    "error": "customerresources.guest_ins.phone_exists",
		    "detail": "phone = 89991232212",
		    "message": "Такой номер телефона уже принадлежит другому пользователю!"
	    }
	]
}
```

### Изменение гостя (GuestUpd)
```sql
SELECT customerresources.guestupd(_src := '
                                  {
                                    "guest_id": 2,
                                    "name": "Щенин Иван Васильевич",
                                    "phone": "89991232233",
                                    "email": "ivan2602@gmail.com",
                                    "birth_day": "1988-10-08"
                                  }
                                  ', _ch_employee := 2);
```
Пример ответа при правильном выполнении:
```jsonb
{"data" : null}
```
Примеры ошибок:
```jsonb 
{
	"errors": [
	    {
		    "error": "customerresources.guest_ins.phone_exists",
		    "detail": "phone = 89991232233",
		    "message": "Такой номер телефона уже принадлежит этому пользователю!"
	    }
	]
}
```