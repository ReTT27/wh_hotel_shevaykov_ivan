# hotel



# Таблицы
### Таблица персонала (Employee)
Данная таблица хранит данные о персонале.  

| Название столбца | Тип данных  | Описание                                                  |
|:----------------:|:-----------:|:----------------------------------------------------------|
|   employee_id    |     INT     | Индивидуальный номер сотрудника                           |
|       name       |   VARCHAR   | Фамилия Имя Отчество (ФИО)                                |
|      phone       |   VARCHAR   | Номер телефона                                            |
|      email       |   VARCHAR   | Электронная почта                                         |
|   position_id    |  SMALLINT   | Индивидуальный номер должности                            |
|      reward      |   NUMERIC   | Дополнительное денежное вознаграждение (премия) или штраф |
|    is_deleted    |   BOOLEAN   | Уволен ли сотрудник (TRUE - да, FALSE - нет)              |
|   ch_employee    |     INT     | Индивидуальный номер сотрудника, который изменяет запись  |
|      dt_ch       | TIMESTAMPTZ | Дата изменения записи                                     |

### Таблица уборки (Cleaning)
Данная таблица хранит данные об уборке номеров.  

| Название столбца | Тип данных  | Описание                                                 |
|:----------------:|:-----------:|:---------------------------------------------------------|
|   cleaning_id    |     INT     | Индивидуальный номер уборки                              |
|   employee_id    |     INT     | Индивидуальный номер сотрудника                          |
|     room_id      |  SMALLINT   | Индивидуальный номер гостничного номера                  |
|  date_cleaning   |    DATE     | Дата уборки                                              |
|   ch_employee    |     INT     | Индивидуальный номер сотрудника, который изменяет запись |
|      dt_ch       | TIMESTAMPTZ | Дата изменения записи                                    |

### Таблица брони (Reservation)
Данная таблица хранит данные о брони гостиничного номера.  

| Название столбца | Тип данных  | Описание                                                 |
|:----------------:|:-----------:|:---------------------------------------------------------|
|  reservation_id  |     INT     | Индивидуальный номер брони                               |
|     room_id      |  SMALLINT   | Индивидуальный номер гостиничного номера                 |
|     guest_id     |     INT     | Индивидуальный номер гостя                               |
|     dt_entry     | TIMESTAMPTZ | Дата въезда                                              |
|     dt_exit      | TIMESTAMPTZ | Дата выезда                                              |
|   is_reserved    |   BOOLEAN   | Завершилась ли бронь (TRUE - да, FALSE - нет)            |
|   ch_employee    |     INT     | Индивидуальный номер сотрудника, который изменяет запись |
|      dt_ch       | TIMESTAMPTZ | Дата изменения записи                                    |

### Таблица гостиничного номера (Rooms)
Данная таблица хранит данные о гостиничном номере.  

| Название столбца | Тип данных | Описание                                                     |
|:----------------:|:----------:|:-------------------------------------------------------------|
|     room_id      |  SMALLINT  | Индивидуальный номер гостиничного номера                     |
|     type_id      |  SMALLINT  | Индивидуальный номер типа гостиничного номера                |
|      level       |  SMALLINT  | Этаж гостиничного номера                                     |

### Таблица продаж (Sales)
Данная таблица хранит данные о продажах.  

| Название столбца | Тип данных  | Описание                                                                  |
|:----------------:|:-----------:|:--------------------------------------------------------------------------|
|     sale_id      |     INT     | Индивидуальный номер продаж                                               |
|   employee_id    |     INT     | Индивидуальный номер сотрудника                                           |
|     visitors     |    JSONB    | Фамилия Имя Отчество (ФИО) заселяющихся людей вместе с гостем (если есть) |
|  reservation_id  |     INT     | Индивидуальный номер брони                                                |
|   typefeed_id    |  SMALLINT   | Индивидуальный номер типа питания                                         |
|    review_id     |     INT     | Индивидуальный номер отзыва (если есть)                                   |
|       sale       |   NUMERIC   | Стоимость продажи                                                         |
|   ch_employee    |     INT     | Индивидуальный номер сотрудника, который изменяет запись                  |
|      dt_ch       | TIMESTAMPTZ | Дата изменения записи                                                     |

### Таблица отзывов (Reviews)
Данная таблица хранит данные об отзывах.  

| Название столбца | Тип данных | Описание                                                   |
|:----------------:|:----------:|:-----------------------------------------------------------|
|    review_id     |    INT     | Индивидуальный номер отзыва                                |
|   date_review    |    DATE    | Дата отзыва                                                |
|     category     |  SMALLINT  | Категория отзыва (положительный - 0 или отрицательный - 1) |
|     content      |  VARCHAR   | Содержание отзыва                                          |

### Таблица работающих сотрудников (Working)
Данная таблица хранит данные о работающих в данный момент сотрудников.  

| Название столбца | Тип данных  | Описание                                         |
|:----------------:|:-----------:|:-------------------------------------------------|
|     at_work      |  BIGSERIAL  | Индивидуальный номер взаимодействия с турникетом |
|   employee_id    |     INT     | Индивидуальный номер сотрудника                  |
|    dt_touches    | TIMESTAMPTZ | Дата взаимодействия с турникетом                 |

### Таблица набора вещей (CleaningThing)
Данная таблица хранит данные о наборах вещей.  

| Название столбца | Тип данных  | Описание                                                 |
|:----------------:|:-----------:|:---------------------------------------------------------|
|      set_id      |  BIGSERIAL  | Индивидуальный номер набора                              |
|   cleaning_id    |     INT     | Индивидуальный номер уборки                              |
|     thing_id     |  SMALLINT   | Индивидуальный номер вещи                                |
|   thing_count    |  SMALLINT   | Количество вещей                                         |
|   ch_employee    |     INT     | Индивидуальный номер сотрудника, который изменяет запись |
|      dt_ch       | TIMESTAMPTZ | Дата изменения записи                                    |

# Функции
### Добавления сотрудника (EmployeeUpd)
```sql
SELECT hotel.employeeupd(_src := '
                         {
                           "name": "Лазарева Карина Витальевна",
                           "phone": "89221441235",
                           "email": "sh4@gmail.com",
                           "position_id": 6,
                           "reward": 5000,
                           "is_deleted": false
                         }
                         ', _ch_employee := 2);
```
Пример ответа при правильном выполнении:
```jsonb
{"data" : null}
```

### Изменение сотрудника (EmployeeUpd)
При изменение сотрудника изменяются все поля.
```sql
SELECT hotel.employeeupd(_src := '
                         {
                           "employee_id": 4,
                           "name": "Макаров Максим Артёмович",
                           "phone": "89221441234",
                           "email": "sh3@gmail.com",
                           "position_id": 6,
                           "reward": 3000,
                           "is_deleted": false
                         }
                         ', _ch_employee := 2);
```
Пример ответа при правильном выполнении:
```jsonb
{"data" : null}
```

### Фиксирование сотрудника на работе (WorkingUpd)
```sql
SELECT hotel.workingupd(_src := '
                         {
                           "employee_id": 4
                         }
                         ');
```
Пример ответа при правильном выполнении:
```jsonb
{"data" : null}
```

### Добавления гостиничного номера (RoomsUpd)
```sql
SELECT hotel.roomsupd('
{
  "type_id": 1,
  "level": 1
}
');
```
Пример ответа при правильном выполнении:
```jsonb
{"data" : null}
```

### Изменение гостиничного номера (RoomsUpd)
При изменение изменяется только поле типа комнаты (type_id)
```sql
SELECT hotel.roomsupd('
{
  "room_id": 12,
  "type_id": 2,
  "level": 1
}
');
```
Пример ответа при правильном выполнении:
```jsonb
{"data" : null}
```

### Добавленгие брони (ReservationUpd)
```sql
SELECT hotel.reservationupd(_src := '
                         {
                              "room_id": 11,
                              "guest_id": 2,
                              "dt_entry": "2023-10-15 14:00:00",
                              "dt_exit": "2023-10-18 12:00:00",
                              "is_reserved": true
                         }
                         ', _ch_employee := 2);
```
Пример ответа при правильном выполнении:
```jsonb
{"data" : null}
```
Примеры ошибок:
```jsonb 
{
	"errors": [
	    {
		    "error": "hotel.reservation_ins.date",
		    "detail": "dt_entry = 2023-10-19 14:00:00+00 dt_exit = 2023-10-18 12:00:00+00",
		    "message": "Даты въезда и выезда некорректны!"
	    }
	]
}
```

### Изменение брони (ReservationUpd)
```sql
SELECT hotel.reservationupd(_src := '
                         {
                              "reservation_id": 1,
                              "room_id": 12,
                              "guest_id": 2,
                              "dt_entry": "2023-10-15 14:00:00",
                              "dt_exit": "2023-10-18 12:00:00",
                              "is_reserved": true
                         }
                         ', _ch_employee := 2);
```
Пример ответа при правильном выполнении:
```jsonb
{"data" : null}
```

### Добавления сотрудника на уборку (CleaningUpd)
```sql
SELECT hotel.cleaningupd(_src := '
                         {
                           "employee_id": 14,
                           "room_id": 12
                         }
                         ', _ch_employee := 2);
```
Пример ответа при правильном выполнении:
```jsonb
{"data" : null}
```

### Изменение сотрудника на уборку (CleaningUpd)
```sql
SELECT hotel.cleaningupd(_src := '
                         {
                           "cleaning_id": 2,
                           "employee_id": 15,
                           "room_id": 12
                         }
                         ', _ch_employee := 2);
```
Пример ответа при правильном выполнении:
```jsonb
{"data" : null}
```

### Добавления вещей к уборке (CleaningThingUpd)
```sql
SELECT hotel.cleaningthingupd(_src := '
                              {
                                "cleaning_id": 2,
                                "thing_id": 2,
                                "thing_count": 1
                              }
                              ', _ch_employee := 2);
```
Пример ответа при правильном выполнении:
```jsonb
{"data" : null}
```

### Добавления продажи (SalesUpd)
```sql
SELECT hotel.salesupd(_src := '
                      {
                        "employee_id": 2,
                        "visitors": [
                          {
                            "name": "Наумов Никита Викторович"
                          },
                          {
                            "name": "Прохоров Марк Русланович"
                          }
                        ],
                        "reservation_id": 1,
                        "typefeed_id": 2,
                        "cash": 0
                      }
                      ',_ch_employee :=  2);
```
Пример ответа при правильном выполнении:
```jsonb
{"data" : null}
```
Пример ошибок:
```jsonb
{
	"errors": [
	{
		"error": "hotel.sales_ins.cash",
		"detail": "cash = -19",
		"message": "Кешбэк введен не верно!"
	}]
}
```

### Добавления отзыва (ReviewsUpd)
```sql
SELECT hotel.reviewsupd(_src := '
                      {
                        "category": 0,
                        "content": "Все очень понравилось!",
                        "sale_id": 1
                      }
                      ', _ch_employee := 2);
```
Пример ответа при правильном выполнении:
```jsonb
{"data" : null}
```

### Вывод уборок (CleaningGet)
На вход есть необязательные параметры, с их помощью осуществляется фильтрация данных.

| Название столбца | Тип данных | Описание                                |
|:----------------:|:----------:|:----------------------------------------|
|   _cleaning_id   |    INT     | Индивидуальный номер уборки             |
|   _employee_id   |    INT     | Индивидуальный номер сотрудника         |
|     _room_id     |    INT     | Индивидуальный номер гостничного номера |
|      _date       |    DATE    | Дата уборки                             |
```sql
SELECT hotel.cleaningget(_cleaning_id := null, _employee_id := null, _room_id := 12, _date := null);
```
Пример ответа при правильном выполнении:
```jsonb
{
	"data": [
	{
		"dt_ch": "2023-10-16T19:40:43.248217+00:00",
		"room_id": 12,
		"ch_employee": 2,
		"cleaning_id": 2,
		"employee_id": 15,
		"date_cleaning": "2023-10-16"
	},
	{
		"dt_ch": "2023-10-16T19:42:00.261309+00:00",
		"room_id": 12,
		"ch_employee": 2,
		"cleaning_id": 5,
		"employee_id": 12,
		"date_cleaning": "2023-10-16"
	}]
}
```

### Вывод вещей для уборок (CleaningThingGet)
На вход есть необязательные параметры, с их помощью осуществляется фильтрация данных.

| Название столбца | Тип данных | Описание                    |
|:----------------:|:----------:|:----------------------------|
|     _set_id      |   BIGINT   | Индивидуальный номер набора |
|   _cleaning_id   |    INT     | Индивидуальный номер уборки |
|    _thing_id     |    INT     | Индивидуальный номер вещи   |
```sql
SELECT hotel.cleaningthingget(_set_id := null, _cleaning_id := null, _thing_id := null);
```
Пример ответа при правильном выполнении:
```jsonb
{
	"data": [
	{
		"dt_ch": "2023-10-16T19:46:27.412954+00:00",
		"set_id": 1,
		"thing_id": 2,
		"ch_employee": 2,
		"cleaning_id": 2,
		"thing_count": 1
	}]
}
```

### Вывод сотрудников (EmployeeGet)
На вход есть необязательные параметры, с их помощью осуществляется фильтрация данных.

| Название столбца | Тип данных | Описание                                     |
|:----------------:|:----------:|:---------------------------------------------|
|   _employee_id   |    INT     | Индивидуальный номер сотрудника              |
|      _phone      |  VARCHAR   | Номер телефона                               |
|   _is_deleted    |  BOOLEAN   | Уволен ли сотрудник (TRUE - да, FALSE - нет) |
```sql
SELECT hotel.employeeget(_employee_id := null, _phone := '89221441133', _is_deleted := null);
```
Пример ответа при правильном выполнении:
```jsonb
{
	"data": [
	{
		"name": "Шевяков Иван Максимович",
		"dt_ch": "2023-10-15T16:41:23.877933+00:00",
		"email": "sh@gmail.com",
		"phone": "89221441133",
		"reward": 25000.00,
		"is_deleted": false,
		"ch_employee": 0,
		"employee_id": 1,
		"position_id": 1
	}]
}
```

### Вывод брони (ReservationGet)
На вход есть необязательные параметры, с их помощью осуществляется фильтрация данных.

| Название столбца | Тип данных | Описание                                      |
|:----------------:|:----------:|:----------------------------------------------|
| _reservation_id  |    INT     | Индивидуальный номер брони                    |
|     _room_id     |    INT     | Индивидуальный номер гостиничного номера      |
|    _guest_id     |    INT     | Индивидуальный номер гостя                    |
|   _is_reserved   |  BOOLEAN   | Завершилась ли бронь (TRUE - да, FALSE - нет) |
```sql
SELECT hotel.reservationget(_reservation_id := null, _room_id := null, _guest_id := null, _is_reserved := null);
```
Пример ответа при правильном выполнении:
```jsonb
{
	"data": [
	{
		"dt_ch": "2023-10-15T21:43:18.553151+00:00",
		"dt_exit": "2023-10-18T12:00:00+00:00",
		"room_id": 12,
		"dt_entry": "2023-10-15T14:00:00+00:00",
		"guest_id": 2,
		"ch_employee": 2,
		"is_reserved": true,
		"reservation_id": 1
	},
	{
		"dt_ch": "2023-10-17T17:07:30.578281+00:00",
		"dt_exit": "2023-10-18T12:00:00+00:00",
		"room_id": 14,
		"dt_entry": "2023-10-15T14:00:00+00:00",
		"guest_id": 4,
		"ch_employee": 2,
		"is_reserved": true,
		"reservation_id": 4
	}]
}
```

### Вывод отзывов (ReviewsGet)
На вход есть необязательные параметры, с их помощью осуществляется фильтрация данных.

| Название столбца | Тип данных | Описание                                                   |
|:----------------:|:----------:|:-----------------------------------------------------------|
|    _review_id    |    INT     | Индивидуальный номер отзыва                                |
|   _date_review   |    DATE    | Дата отзыва                                                |
|    _category     |    INT     | Категория отзыва (положительный - 0 или отрицательный - 1) |
```sql
SELECT hotel.reviewsget(_review_id := null, _category := null);
```
Пример ответа при правильном выполнении:
```jsonb
{
	"data": [
	{
		"content": "Все очень понравилось!",
		"category": 0,
		"review_id": 1,
		"date_review": "2023-10-17"
	}]
}
```

### Вывод комнат (RoomsGet)
На вход есть необязательные параметры, с их помощью осуществляется фильтрация данных.

| Название столбца | Тип данных | Описание                                      |
|:----------------:|:----------:|:----------------------------------------------|
|     _room_id     |    INT     | Индивидуальный номер гостиничного номера      |
|     _type_id     |    INT     | Индивидуальный номер типа гостиничного номера |
|      _level      |    INT     | Этаж гостиничного номера                      |
```sql
SELECT hotel.roomsget(_room_id := null, _type_id := null, _level := null);
```
Пример ответа при правильном выполнении:
```jsonb
{
	"data": [
	{
		"level": 1,
		"room_id": 10,
		"type_id": 1
	},
	{
		"level": 1,
		"room_id": 11,
		"type_id": 1
	},
	{
		"level": 1,
		"room_id": 13,
		"type_id": 2
	},
	{
		"level": 1,
		"room_id": 14,
		"type_id": 3
	},
	{
		"level": 1,
		"room_id": 15,
		"type_id": 2
	},
	{
		"level": 1,
		"room_id": 16,
		"type_id": 2
	},
	{
		"level": 1,
		"room_id": 17,
		"type_id": 3
	},
	{
		"level": 1,
		"room_id": 18,
		"type_id": 3
	},
	{
		"level": 1,
		"room_id": 19,
		"type_id": 1
	},
	{
		"level": 2,
		"room_id": 20,
		"type_id": 1
	},
	{
		"level": 2,
		"room_id": 21,
		"type_id": 1
	},
	{
		"level": 2,
		"room_id": 22,
		"type_id": 1
	},
	{
		"level": 2,
		"room_id": 23,
		"type_id": 3
	},
	{
		"level": 2,
		"room_id": 24,
		"type_id": 3
	},
	{
		"level": 2,
		"room_id": 25,
		"type_id": 3
	},
	{
		"level": 2,
		"room_id": 26,
		"type_id": 2
	},
	{
		"level": 2,
		"room_id": 27,
		"type_id": 2
	},
	{
		"level": 2,
		"room_id": 28,
		"type_id": 2
	},
	{
		"level": 2,
		"room_id": 29,
		"type_id": 1
	},
	{
		"level": 1,
		"room_id": 12,
		"type_id": 2
	}]
}
```

### Вывод сотрудников (SalesGet)
На вход есть необязательные параметры, с их помощью осуществляется фильтрация данных.

| Название столбца | Тип данных | Описание                        |
|:----------------:|:----------:|:--------------------------------|
|     _sale_id     |    INT     | Индивидуальный номер продаж     |
|   _employee_id   |    INT     | Индивидуальный номер сотрудника |
| _reservation_id  |    INT     | Индивидуальный номер брони      |
|    _review_id    |    INT     | Индивидуальный номер отзыва     |
```sql
SELECT hotel.salesget( _sale_id := null, _employee_id := null, _reservation_id := null, _review_id := 1);
```
Пример ответа при правильном выполнении:
```jsonb
{
	"data": [
	{
		"sale": 15809.88,
		"dt_ch": "2023-10-17T13:03:11.163156+00:00",
		"sale_id": 1,
		"visitors": [
		{
			"name": "Наумов Никита Викторович"
		},
		{
			"name": "Прохоров Марк Русланович"
		}],
		"review_id": 1,
		"ch_employee": 2,
		"employee_id": 2,
		"typefeed_id": 2,
		"reservation_id": 1
	}]
}
```

### Вывод сотрудников на работе (WorkingGet)
На вход есть необязательные параметры, с их помощью осуществляется фильтрация данных.

| Название столбца | Тип данных | Описание                         |
|:----------------:|:----------:|:---------------------------------|
|   _employee_id   |    INT     | Индивидуальный номер сотрудника  |
|   _dt_touches    |    DATE    | Дата взаимодействия с турникетом |
```sql
SELECT hotel.workingget( _employee_id := 11, _dt_touches := null);
```
Пример ответа при правильном выполнении:
```jsonb
{
	"data": [
	{
		"at_work": 2,
		"dt_touches": "2023-10-16T15:35:49.225054+00:00",
		"employee_id": 11
	}]
}
```